# VinylTimecodeCHOP v1.2.0 - リリースノート

**リリース日**: 2024-10-26

---

## 🎉 主な改善

### Issue #2 を解決: 逆回し時の滑らかな position 変化

**問題**:
- v1.1.0 では、逆回し時に position が大きく飛び飛びになっていた
- raw_position が -1 を頻繁に返すため、position が更新されない期間があった
- 次に有効な値が来た時に大きくジャンプしていた

**解決策**:
- **pitch ベースの補間**を実装
- raw_position が -1 の間も、pitch を使って position を推定
- `position の変化量 = pitch × サンプル数` で計算

**結果**:
✅ **逆回し時**: position が滑らかに減少  
✅ **通常再生時**: position が滑らかに増加（引き続き正常）  
✅ **停止時**: position が固定（Issue #1 で解決済み、引き続き正常）

---

## 🔧 技術的な詳細

### 補間ロジック

```cpp
if (myRawPosition >= 0) {
    // 有効な position を受信
    myPosition = static_cast<double>(myRawPosition);
    myLastValidPosition = myPosition;
} else if (std::abs(myPitch) > 0.01) {
    // pitch ベースで補間
    double positionChange = myPitch * numSamples;
    myPosition = myLastValidPosition + positionChange;
    myLastValidPosition = myPosition;
} else {
    // 停止時は最後の値を保持
    myPosition = myLastValidPosition;
}
```

### 追加メンバー変数

- `myLastNumSamples`: サンプル数を保存（補間計算で使用）

### 動作の仕組み

1. **raw_position が有効（>= 0）の場合**:
   - そのまま使用
   - 最も正確な値

2. **raw_position が -1 で pitch がある場合**:
   - pitch × サンプル数で position の変化量を計算
   - 最後の有効な position に変化量を加算
   - 滑らかな動きを実現

3. **raw_position が -1 で pitch が 0 付近の場合**:
   - 停止と判断
   - 最後の値を保持

---

## ✨ 動作確認

### ユーザーからの報告

> 「raw_position は -1 になりますが、position は良い感じです。」

### Info CHOP での確認

**逆回し時**:
```
raw_position:    -1（xwax の仕様、正常）
position:        滑らかに減少 ✅
pitch:           -1.0 付近（逆再生速度）
valid_counter:   変動
```

**通常再生時**:
```
raw_position:    292652.53（有効な値）
position:        292652.53（同じ）
pitch:           1.0 付近（通常速度）
valid_counter:   > 24
```

**停止時**:
```
raw_position:    -1（信号なし、正常）
position:        最後の値で固定 ✅
pitch:           0.0 付近
valid_counter:   <= 24
```

---

## 📝 バージョン履歴

### v1.2.0 (2024-10-26) - 現在のバージョン
- ✅ Issue #2 を解決: 逆回し時の滑らかな position 変化
- ✅ pitch ベースの補間を実装

### v1.1.0 (2024-10-26)
- ✅ Issue #1 を解決: position が -1 になる問題
- ✅ Info CHOP に `raw_position` チャンネルを追加

### v1.0.0 (2024-10-25)
- 🎉 初回成功: Pioneer RekordBox DVS で動作確認

---

## 🎯 対応状況まとめ

### 完全に動作する機能

| 機能 | ステータス | バージョン |
|------|-----------|-----------|
| **通常再生** | ✅ 完全動作 | v1.0.0 |
| **レコード停止** | ✅ 完全動作 | v1.1.0 |
| **逆回し（スクラッチ）** | ✅ 完全動作 | v1.2.0 |
| **速度変化** | ✅ 滑らかに追従 | v1.2.0 |
| **pitch 検出** | ✅ 正確に動作 | v1.0.0 |
| **quality 検出** | ✅ 正確に動作 | v1.0.0 |

### 動作確認済み構成

```
ハードウェア:     Native Instruments Interface 2
バイナル:         Pioneer RekordBox DVS Side A
サンプルレート:   44100 Hz
スイッチ:         LINE (NOT PHONO)
TouchDesigner:    2023.11760
macOS:            Apple Silicon / Intel Universal Binary
```

---

## 🚀 次のステップ

### 推奨される使用方法

1. **Info CHOP で状態を確認**:
   - `position`: 実際に使用する値（補間後）
   - `raw_position`: デバッグ用（-1 が出ても正常）
   - `pitch`: 速度の確認
   - `quality`: 信号品質の確認

2. **TouchDesigner ネットワーク**:
   ```
   [Audio Device In CHOP]
       ↓
   [VinylTimecode CHOP]
       ↓
   [Math CHOP] - position を使用してビジュアル制御
       ↓
   [Your Creative Output]
   ```

3. **パフォーマンスモード**:
   - `Cook Every Frame`: Off（推奨）
   - `Time Slice`: Audio Device In で On

---

## 📚 参考ドキュメント

- [QUICKSTART.md](../QUICKSTART.md) - クイックスタートガイド
- [TROUBLESHOOTING.md](../TROUBLESHOOTING.md) - トラブルシューティング
- [docs/issues.md](issues.md) - 問題の詳細と解決策
- [CHANGELOG.md](../CHANGELOG.md) - 完全な変更履歴
- [docs/success-config.md](success-config.md) - 成功構成の詳細

---

## 🎵 Happy Scratching!

VinylTimecodeCHOP v1.2.0 で、スムーズな逆回しとスクラッチをお楽しみください！

**完全に動作する機能**:
- ✅ 通常再生
- ✅ 逆回し（スクラッチ）
- ✅ 停止
- ✅ 速度変化

すべてが滑らかに、正確に動作します。

---

**最終更新**: 2024-10-26
